<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BLE PWA App</title>
  <link rel="manifest" href="manifest.json" />
</head>
<body>
  <h1>BLE送信アプリ</h1>
  <button id="connect">BLE接続</button>
  <button id="send">ドンを送信</button>

  <script>
    let bleDevice;
    let bleCharacteristic;

    document.getElementById("connect").addEventListener("click", async () => {
      try {
        bleDevice = await navigator.bluetooth.requestDevice({
          filters: [{ services: ["12345678-1234-1234-1234-1234567890ab"] }],
          optionalServices: ["abcd1234-abcd-1234-abcd-1234567890ab"]
        });
        const server = await bleDevice.gatt.connect();
        const service = await server.getPrimaryService("12345678-1234-1234-1234-1234567890ab");
        bleCharacteristic = await service.getCharacteristic("abcd1234-abcd-1234-abcd-1234567890ab");
        alert("接続成功！");
      } catch (err) {
        alert("接続失敗：" + err);
      }
    });

    document.getElementById("send").addEventListener("click", async () => {
      if (bleCharacteristic) {
        const encoder = new TextEncoder();
        await bleCharacteristic.writeValue(encoder.encode("start"));
        alert("送信しました！");
      }
    });
  </script>
</body>
</html>
